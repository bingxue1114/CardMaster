<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CardMaster 2026 - 權益導航動態版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; }
        .best-card { transform: scale(1.02); border-color: #f59e0b; box-shadow: 0 15px 30px -10px rgba(245, 158, 11, 0.3); }
        .list-move, .list-enter-active { transition: all 0.4s ease; }
        .modal-enter-active, .modal-leave-active { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .modal-enter-from, .modal-leave-to { opacity: 0; transform: translateY(50px); }
        input[type=range] { -webkit-appearance: none; background: #e2e8f0; border-radius: 99px; height: 8px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: #f59e0b; cursor: pointer; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    </style>
</head>
<body class="max-w-md mx-auto">

<div id="app" class="min-h-screen pb-24">
    <header class="p-6 bg-slate-900 text-white rounded-b-[2.5rem] shadow-xl mb-6">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-black text-amber-400 tracking-tight">CardMaster</h1>
                <p class="text-[10px] opacity-50 font-bold tracking-widest uppercase">2026 權益方案導航版</p>
            </div>
            <div class="bg-white/10 px-3 py-1 rounded-full border border-white/20 text-[10px] font-bold text-amber-200">
                v1.0
            </div>
        </div>
    </header>

    <div class="px-5 space-y-5">
        <div class="space-y-3">
            <div class="relative">
                <div class="flex items-center bg-white rounded-3xl p-4 shadow-sm border-2 border-transparent focus-within:border-amber-400 transition-all">
                    <i class="fas fa-search text-slate-300 mr-3"></i>
                    <input v-model="shopInput" @input="showSuggestions = true" type="text" placeholder="在哪消費？如：7-11、Uber" class="w-full bg-transparent focus:outline-none text-slate-700 font-bold">
                    <i v-if="shopInput" @click="clearSearch" class="fas fa-times-circle text-slate-300 cursor-pointer"></i>
                </div>
                <div v-if="suggestions.length > 0 && showSuggestions" class="absolute z-50 w-full bg-white border rounded-2xl mt-2 shadow-2xl overflow-hidden">
                    <div v-for="s in suggestions" :key="s.name" @click="selectShop(s)" class="p-4 hover:bg-amber-50 cursor-pointer border-b last:border-0 flex justify-between items-center">
                        <span class="font-bold text-slate-700">{{ s.name }}</span>
                        <span class="text-[10px] bg-slate-100 text-slate-500 px-2 py-1 rounded-full">{{ s.category }}</span>
                    </div>
                </div>
            </div>

            <div class="flex items-center bg-white rounded-3xl p-4 shadow-sm border-2 border-transparent focus-within:border-amber-400">
                <span class="text-amber-500 font-black mr-3 text-xl">$</span>
                <input v-model.number="amount" type="number" class="w-full bg-transparent focus:outline-none font-mono text-xl font-bold">
            </div>

            <div class="bg-white p-4 rounded-3xl shadow-sm border border-slate-100">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-[10px] font-black text-slate-400 uppercase">中信 UNI 任務：{{ uniCount }} 家</span>
                    <span class="text-[10px] font-bold text-orange-500 bg-orange-50 px-2 rounded">加碼中</span>
                </div>
                <input v-model.number="uniCount" type="range" min="1" max="5" step="1" class="w-full">
            </div>
        </div>

        <div class="space-y-4">
            <h2 class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] ml-2">智能推薦排行</h2>
            <transition-group name="list">
                <div v-for="(res, index) in sortedResults" :key="res.id" 
                    class="bg-white p-5 rounded-[2.5rem] border-2 transition-all duration-300 relative"
                    :class="[index === 0 ? 'best-card border-amber-400' : 'border-transparent opacity-90 shadow-sm']">
                    
                    <div class="flex justify-between items-start">
                        <div class="flex items-center">
                            <div :class="['w-10 h-10 rounded-2xl flex items-center justify-center mr-3 text-white shadow-sm', res.iconColor]">
                                <i :class="res.icon"></i>
                            </div>
                            <div>
                                <p class="text-[9px] font-bold text-slate-400 uppercase">{{ res.bank }}</p>
                                <h3 class="text-md font-black text-slate-800">{{ res.name }}</h3>
                            </div>
                        </div>
                        <div class="text-right flex flex-col items-end">
                            <div class="text-2xl font-black tracking-tighter text-slate-800">{{ res.rate }}%</div>
                            <button @click="openModal(res)" class="text-[10px] font-bold bg-slate-800 text-white px-3 py-1 rounded-full mt-1 active:scale-95 transition-transform">
                                詳情 <i class="fas fa-chevron-right ml-0.5"></i>
                            </button>
                        </div>
                    </div>

                    <div class="mt-4 pt-3 border-t border-slate-50 flex justify-between items-end">
                        <div class="w-2/3">
                            <div class="flex items-center space-x-1 mb-1">
                                <span class="bg-slate-800 text-white text-[9px] px-2 py-0.5 rounded font-bold tracking-tighter uppercase">建議方案</span>
                                <span class="text-blue-600 text-[11px] font-black">{{ res.plan }}</span>
                            </div>
                            <p class="text-[10px] text-slate-400 leading-relaxed font-medium">{{ res.note }}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-xl font-black text-slate-800">{{ calculateReward(amount, res.rate, res.rounding) }}</span>
                            <span class="text-[10px] font-bold text-slate-400 ml-1">點</span>
                        </div>
                    </div>
                </div>
            </transition-group>
        </div>
    </div>

    <transition name="modal">
        <div v-if="activeCard" class="fixed inset-0 z-[100] flex items-end justify-center px-4 pb-10">
            <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" @click="activeCard = null"></div>
            <div class="bg-white w-full max-w-sm rounded-[3rem] p-8 shadow-2xl relative z-10 border-t-8 border-amber-400 max-h-[85vh] overflow-y-auto">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h4 class="text-xs font-black text-amber-500 uppercase tracking-widest">{{ activeCard.bank }}</h4>
                        <h3 class="text-2xl font-black text-slate-800">{{ activeCard.name }}</h3>
                    </div>
                    <button @click="activeCard = null" class="bg-slate-100 text-slate-400 w-10 h-10 rounded-full flex items-center justify-center">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="space-y-6">
					<!---
                    <div>
                        <p class="text-[10px] font-black text-slate-400 uppercase mb-2">當前推薦方案說明</p>
                        <p class="text-slate-700 font-bold text-md leading-relaxed bg-blue-50 p-4 rounded-2xl border border-blue-100 italic">
                            {{ activeCard.planDesc }}
                        </p>
                    </div>
					--->
                    <div>
                        <p class="text-[10px] font-black text-slate-400 uppercase mb-2">方案適用通路細節</p>
                        <div class="space-y-3">
                            <div v-for="group in activeCard.dynamicScope" :key="group.title" class="border-l-4 border-amber-200 pl-3">
                                <p class="text-[11px] font-black text-slate-800 uppercase">{{ group.title }}</p>
                                <p class="text-[11px] text-slate-500 font-medium leading-relaxed">{{ group.shops }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-amber-50 p-4 rounded-3xl border border-amber-100">
                        <p class="text-[10px] font-black text-amber-600 uppercase mb-1">回饋上限與規則</p>
                        <p class="text-sm font-bold text-amber-900 leading-tight">{{ activeCard.limit }}</p>
                    </div>

                    <p class="text-[10px] text-slate-400 italic text-center pt-2">* 回饋類型：{{ activeCard.pointType }}</p>
                </div>
            </div>
        </div>
    </transition>
</div>

<script>
const { createApp, ref, computed } = Vue;

createApp({
    setup() {
        const shopInput = ref('');
        const amount = ref(1000);
        const uniCount = ref(5);
        const showSuggestions = ref(false);
        const activeCard = ref(null);

        const shopDatabase = [
            // 台新
			{ name: '台新Pay', category: '支付方式' },{ name: '台灣Pay', category: '支付方式' },{ name: '台新Pay+', category: '支付方式' },
			{ name: 'LINE Pay', category: '支付方式' },{ name: '7-11', category: '超商量販' },{ name: '全家', category: '超商量販' },
			{ name: '家樂福', category: '超商量販' },{ name: '大買家', category: '超商量販' },{ name: '唐吉軻德', category: '超商量販' },
			{ name: 'LOPIA', category: '超商量販' },{ name: '台鐵', category: '通勤交通' },{ name: '高鐵', category: '通勤交通' },
			{ name: '台灣大車隊', category: '通勤交通' },{ name: 'LINEGO', category: '通勤交通' },{ name: 'Yoxi', category: '通勤交通' },
			{ name: 'Uber', category: '通勤交通' },{ name: '台灣Bolt', category: '通勤交通' },{ name: '中油直營', category: '加油充電' },
			{ name: '全國加油', category: '加油充電' },{ name: '全國特急電', category: '加油充電' },{ name: '源點EVOASIS', category: '加油充電' },
			{ name: '華城電能EVALUE', category: '加油充電' },{ name: 'USPACE', category: '加油充電' },{ name: 'Autopass(車麻吉)', category: '加油充電' },
			{ name: '寶雅', category: '藥妝藥局' },{ name: '康是美', category: '藥妝藥局' },{ name: '屈臣氏', category: '藥妝藥局' },
			{ name: '杏一醫療', category: '藥妝藥局' },{ name: '大樹藥局', category: '藥妝藥局' },{ name: '丁丁藥局', category: '藥妝藥局' },
			{ name: '佑全保健藥妝', category: '藥妝藥局' },{ name: '健康人生藥局', category: '藥妝藥局' },{ name: '新光三越', category: '指定百貨' },
			{ name: '遠東百貨', category: '指定百貨' },{ name: '遠東SOGO', category: '指定百貨' },{ name: '漢神巨蛋', category: '指定百貨' },
			{ name: '漢神百貨', category: '指定百貨' },{ name: '微風', category: '指定百貨' },{ name: '台北101', category: '指定百貨' },
			{ name: '遠東巨城', category: '指定百貨' },{ name: '廣三SOGO', category: '指定百貨' },{ name: '南紡購物中心', category: '指定百貨' },
			{ name: '誠品生活', category: '指定百貨' },{ name: '京站', category: '指定百貨' },{ name: '三創生活', category: '指定百貨' },
			{ name: '夢時代', category: '指定百貨' },{ name: '統一時代', category: '指定百貨' },{ name: '中友百貨', category: '指定百貨' },
			{ name: 'Mitsui Shopping Park LaLaport(南港/台中)', category: '指定百貨' },{ name: 'MITSUI OUTLET PARK (林口/台中港/台南)', category: '指定Outlet' },{ name: '華泰名品城', category: '指定Outlet' },
			{ name: 'SKM Park Outlets', category: '指定Outlet' },{ name: 'IKEA', category: '居家裝修' },{ name: '特力屋', category: '居家裝修' },
			{ name: 'HOLA', category: '居家裝修' },{ name: '宜得利', category: '居家裝修' },{ name: '瑪黑家居', category: '居家裝修' },
			{ name: 'UNIQLO', category: '時尚品味' },{ name: 'GU', category: '時尚品味' },{ name: 'ZARA', category: '時尚品味' },
			{ name: 'NET', category: '時尚品味' },{ name: 'lululemon', category: '時尚品味' },{ name: '王品瘋Pay', category: '全臺餐飲' },
			{ name: 'Uber Eats', category: '外送平台' },{ name: 'Foodpanda', category: '外送平台' },{ name: '拓元售票', category: '購票娛樂' },
			{ name: 'KKTIX', category: '購票娛樂' },{ name: '年代售票', category: '購票娛樂' },{ name: '寬宏售票', category: '購票娛樂' },
			{ name: 'OPENTIX兩廳院文化生活', category: '購票娛樂' },{ name: 'FunNow', category: '購票娛樂' },{ name: '錢櫃', category: '指定KTV' },
			{ name: '好樂迪', category: '指定KTV' },{ name: 'ONCOR', category: '指定KTV' },{ name: 'sing!go', category: '指定KTV' },
			{ name: '享溫馨', category: '指定KTV' },{ name: '晶華國際酒店集團', category: '指定飯店' },{ name: '雲朗觀光', category: '指定飯店' },
			{ name: '台灣萬豪國際集團旗下飯店', category: '指定飯店' },{ name: '煙波國際觀光集團', category: '指定飯店' },{ name: '老爺酒店集團', category: '指定飯店' },
			{ name: '福華集團', category: '指定飯店' },{ name: '漢來飯店事業群', category: '指定飯店' },{ name: '台北君悅酒店', category: '指定飯店' },
			{ name: '高雄洲際酒店', category: '指定飯店' },{ name: '臺中勤美洲際酒店', category: '指定飯店' },{ name: '礁溪寒沐酒店', category: '指定飯店' },
			{ name: '蝦皮', category: '網購平台' },{ name: 'momo', category: '網購平台' },{ name: '酷澎(Coupang)', category: '網購平台' },
			{ name: 'PChome', category: '網購平台' },{ name: '淘寶', category: '網購平台' },{ name: 'Amazon', category: '網購平台' },
			{ name: '東森', category: '網購平台' },{ name: '博客來', category: '網購平台' },{ name: 'Richart Mart', category: '網購平台' },
			{ name: 'PayEasy', category: '網購平台' },{ name: 'iHerb', category: '網購平台' },{ name: 'SHEIN', category: '網購平台' },
			{ name: 'Farfetch', category: '網購平台' },{ name: 'Olive Young', category: '網購平台' },{ name: '知識衛星', category: '線上課程' },
			{ name: 'Amazing Talker', category: '線上課程' },{ name: 'Tutor ABC', category: '線上課程' },{ name: 'Hahow', category: '線上課程' },
			{ name: 'PressPlay', category: '線上課程' },{ name: 'MyCard', category: '遊戲影音' },{ name: '遊戲橘子', category: '遊戲影音' },
			{ name: 'Steam', category: '遊戲影音' },{ name: 'PlayStation', category: '遊戲影音' },{ name: 'Nintendo', category: '遊戲影音' },
			{ name: 'Netfilx', category: '遊戲影音' },{ name: 'Disney+', category: '遊戲影音' },{ name: 'ChatGPT', category: 'AI服務' },
			{ name: 'Notion', category: 'AI服務' },{ name: 'Canva', category: 'AI服務' },{ name: 'Perplexity', category: 'AI服務' },
			{ name: 'Claude', category: 'AI服務' },{ name: '中華航空', category: '航空公司' },{ name: '長榮航空', category: '航空公司' },
			{ name: '星宇航空', category: '航空公司' },{ name: '台灣虎航', category: '航空公司' },{ name: '國泰航空', category: '航空公司' },
			{ name: '華信航空', category: '航空公司' },{ name: '立榮航空', category: '航空公司' },{ name: '樂桃航空', category: '航空公司' },
			{ name: '阿聯酋航空', category: '航空公司' },{ name: '亞洲航空', category: '航空公司' },{ name: '酷航', category: '航空公司' },
			{ name: '捷星航空', category: '航空公司' },{ name: '新加坡航空', category: '航空公司' },{ name: '日本航空', category: '航空公司' },
			{ name: '越捷航空', category: '航空公司' },{ name: 'Uber', category: '海外交通/網路' },{ name: 'Grab', category: '海外交通/網路' },
			{ name: 'SUICA', category: '海外交通/網路' },{ name: 'ICOCA', category: '海外交通/網路' },{ name: 'PASMO', category: '海外交通/網路' },
			{ name: 'WOWPASS', category: '海外交通/網路' },{ name: 'AIRSIM', category: '海外交通/網路' },{ name: 'Klook', category: '訂房平台' },
			{ name: 'KKday', category: '訂房平台' },{ name: 'Agoda', category: '訂房平台' },{ name: 'Booking.com', category: '訂房平台' },
			{ name: 'Trip.com', category: '訂房平台' },{ name: 'Airbnb', category: '訂房平台' },
			{ name: 'Hotels.com', category: '訂房平台' },{ name: 'Expedia', category: '訂房平台' },{ name: '雄獅旅遊', category: '旅行社' },
			{ name: '易遊網', category: '旅行社' },{ name: '東南旅遊', category: '旅行社' },{ name: '可樂旅遊', category: '旅行社' },
			{ name: '長汎假期', category: '旅行社' },{ name: '五福旅遊', category: '旅行社' },{ name: '喜鴻假期', category: '旅行社' },
			{ name: '易飛旅遊', category: '旅行社' },{ name: '燦星旅遊', category: '旅行社' },{ name: '加利利旅行社', category: '旅行社' },
			{ name: '鳳凰國際旅行社', category: '旅行社' },{ name: '山富旅遊', category: '旅行社' },{ name: '行健旅遊', category: '旅行社' },
			{ name: '海外', category: '海外消費' }
        ];

        // --- 新增：動態從資料庫抓取同類別商家的函數 ---
        const getShopsByCategory = (categoryName) => {
            return shopDatabase
                .filter(item => item.category === categoryName)
                .map(item => item.name)
                .join('｜');
        };

        const calculateReward = (amt, rate, mode) => {
            const raw = amt * (rate / 100);
            return mode === 'round' ? Math.round(raw) : Math.floor(raw);
        };

        // --- 核心邏輯：台新 Richart 權益分支 ---
        function getRichart(cat, shop) {
            const s = shop.toUpperCase();
            let base = { bank: '台新銀行', name: 'Richart 卡', pointType: '台新Point' };
            
            // 【天天刷】方案：不再手寫，改從 Database 抓
            const dailyScope = [
                { title: '超商量販', shops: getShopsByCategory('超商量販') },
                { title: '通勤交通', shops: getShopsByCategory('通勤交通') },
                { title: '加油充電', shops: getShopsByCategory('加油充電') },
                { title: '藥妝藥局', shops: getShopsByCategory('藥妝藥局') }
            ];

            // 【好饗刷】方案
            const eatScope = [
                { title: '全臺餐飲', shops: getShopsByCategory('全臺餐飲') },
                { title: '外送平台', shops: getShopsByCategory('外送平台') },
                { title: '購票娛樂', shops: getShopsByCategory('購票娛樂') },
                { title: '指定KTV', shops: getShopsByCategory('指定KTV') },
                { title: '指定飯店', shops: getShopsByCategory('指定飯店') }
            ];

            // 【大筆刷】方案
            const bigScope = [
                { title: '指定百貨', shops: getShopsByCategory('指定百貨') },
                { title: '指定Outlet', shops: getShopsByCategory('指定Outlet') },
                { title: '居家裝修', shops: getShopsByCategory('居家裝修') },
                { title: '時尚品味', shops: getShopsByCategory('時尚品味') }
            ];

            // 【數趣刷】方案 (新增對應你 database 的分類)
            const digitalScope = [
                { title: '網購平台', shops: getShopsByCategory('網購平台') },
                { title: '遊戲影音', shops: getShopsByCategory('遊戲影音') },
                { title: 'AI服務', shops: getShopsByCategory('AI服務') },
                { title: '線上課程', shops: getShopsByCategory('線上課程') }
            ];

            // 【玩旅刷】方案
            const travelScope = [
				{ title: '海外消費', shops: getShopsByCategory('海外消費') },
                { title: '航空公司', shops: getShopsByCategory('航空公司') },
                { title: '訂房平台', shops: getShopsByCategory('訂房平台') },
                { title: '旅行社', shops: getShopsByCategory('旅行社') },
                { title: '海外交通/網路', shops: getShopsByCategory('海外交通/網路') }
            ];

            // 判斷邏輯
            if (s.includes('LINE PAY')) return { ...base, rate: 2.3, plan: '【Pay著刷】', note: '限 LINE PAY 支付', planDesc: '綁定 LINE Pay 支付回饋2.3%。', dynamicScope: [{ title: '指定支付', shops: 'LINE Pay' }], limit: '無上限' };
            if (s.includes('台新PAY')) return { ...base, rate: 3.8, plan: '【Pay著刷】', note: '限 台新Pay 支付', planDesc: '綁定台新 Pay 支付回饋3.8%。', dynamicScope: [{ title: '指定支付', shops: '台新 Pay' }], limit: '無上限' };
            
            if (['超商量販','通勤交通','加油充電','藥妝藥局'].includes(cat)) 
                return { ...base, rate: 3.3, plan: '【天天刷】', note: '需切換權益', planDesc: '日常生活的全方位通路。', dynamicScope: dailyScope, limit: '無上限' };
            
            if (['全臺餐飲','外送平台','購票娛樂','指定KTV','指定飯店'].includes(cat)) 
                return { ...base, rate: 3.3, plan: '【好饗刷】', note: '需切換權益', planDesc: '美食與娛樂首選。', dynamicScope: eatScope, limit: '無上限' };

            if (['指定百貨','指定Outlet','居家裝修','時尚品味'].includes(cat)) 
                return { ...base, rate: 3.3, plan: '【大筆刷】', note: '需切換權益', planDesc: '百貨購物大額支出。', dynamicScope: bigScope, limit: '無上限' };

            if (['網購平台','遊戲影音','AI服務','線上課程'].includes(cat)) 
                return { ...base, rate: 3.3, plan: '【數趣刷】', note: '需切換權益', planDesc: '線上購物與數位訂閱。', dynamicScope: digitalScope, limit: '無上限' };

            if (['海外消費','航空公司','訂房平台','旅行社','海外交通/網路'].includes(cat)) 
                return { ...base, rate: 3.3, plan: '【玩旅刷】', note: '需切換權益', planDesc: '旅遊、機票與海外消費。', dynamicScope: travelScope, limit: '無上限' };

            return { ...base, rate: 0.3, plan: '一般消費', note: '基本回饋', planDesc: '未分類之一般通路。', dynamicScope: [{ title: '一般通路', shops: '非指定方案消費' }], limit: '0.3% 無上限' };
        }

        function getCTBC_UNI(cat, shop, count) {
            const s = shop.toUpperCase();
            const missionRate = count >= 2 ? (count - 1) : 0;
            let base = { bank: '中國信託', name: 'Uni Sense 卡', pointType: 'OpenPoint' };
            const uniScope = [{ title: '統一集團', shops: '7-11｜康是美｜夢時代｜統一時代｜家樂福｜博客來｜W飯店｜MIA C‘BON' }];

            if (cat === '海外消費') return { ...base, rate: 14, plan: '國外實體加碼', note: '含實體加碼11%', planDesc: '國外實體店面神卡。', dynamicScope: [{ title: '海外實體', shops: '日本、韓國等全球實體店鋪' }], limit: '加碼上限 500 點。' };
            if (cat === '超商量販' || s.includes('7-11') || s.includes('家樂福')) 
                return { ...base, rate: 4 + missionRate, plan: '統一集團通路', note: `含任務${missionRate}%`, planDesc: '統一集團生活圈最優。', dynamicScope: uniScope, limit: '各項加碼上限 500 點。' };
            
            return { ...base, rate: 1, plan: '一般消費', note: '一般消費', planDesc: '一般通路回饋。', dynamicScope: [{ title: '一般通路', shops: '國內一般消費' }], limit: '無上限。' };
        }

        function getFed(cat, shop) {
            let base = { bank: '聯邦銀行', name: 'LINE Bank 卡', pointType: '現金回饋' };
            const highRateShops = ['NETFLIX','MOMO','PCHOME','蝦皮','酷澎'];
            const scope = [{ title: '網購電商', shops: '蝦皮｜MOMO｜PCHOME｜酷澎｜Yahoo購物' }];
			// 2. 排除超商
			if (shop.toUpperCase().includes('7-11') || shop.toUpperCase().includes('全家')) {
				return { 
					...base, 
					rate: 0, 
					plan: '無回饋', 
					note: '無回饋', 
					planDesc: '無回饋', 
					dynamicScope: [{ title: '無回饋', shops: '無回饋' }], 
					limit: '無回饋' 
				};
			}
            if (highRateShops.some(s => shop.toUpperCase().includes(s))) return { ...base, rate: 3, plan: '指定通路', note: '上限300元', planDesc: '電商平台專屬加碼。', dynamicScope: scope, limit: '加碼上限 300 元。' };
            return { ...base, rate: 1, plan: '一般消費', note: '超商、麥當勞等小額支付無回饋。', planDesc: '一般通路回饋。', dynamicScope: [{ title: '一般通路', shops: '國內一般消費' }], limit: '無上限。' };
        }
		
		function getCube(cat, shop) {
			const s = shop.toUpperCase();
			let base = { bank: '國泰世華', name: '青年簽帳卡', pointType: '現金回饋' };

			// 2. 排除超商
			if (s.includes('7-11') || s.includes('全家')) {
				return { 
					...base, 
					rate: 0, 
					plan: '無回饋', 
					note: '無回饋', 
					planDesc: '無回饋', 
					dynamicScope: [{ title: '無回饋', shops: '無回饋' }], 
					limit: '無回饋' 
				};
			}
			
			// 1. 指定加碼通路 (通勤交通 或 海外)
			if (s.includes('海外') ||s.includes('台鐵') || s.includes('高鐵')) {
				return { 
					...base, 
					rate: 3, 
					plan: '指定權益', 
					note: '上限300元', 
					planDesc: '交通與海外消費專屬加碼。', 
					dynamicScope: [
						{ title: '通勤交通', shops: getShopsByCategory('通勤交通') },
						{ title: '海外消費', shops: '海外實體店面與指定通路' }
					], 
					limit: '加碼上限 300 元。' 
				};
			}

			// 2. 指定支付 (LINE Pay)
			if (s.includes('LINE PAY')) {
				return { 
					...base, 
					rate: 2, 
					plan: '支付加碼', 
					note: '無上限', 
					planDesc: '綁定指定行動支付消費。', 
					dynamicScope: [{ title: '指定支付', shops: 'LINE Pay' }], 
					limit: '2% 無上限' 
				};
			}

			// 3. 一般消費
			return { 
				...base, 
				rate: 0.3, 
				plan: '一般消費', 
				note: '基本 0.3%', 
				planDesc: '保底現金回饋。', 
				dynamicScope: [{ title: '一般通路', shops: '非指定加碼之消費' }], 
				limit: '無上限' 
			};
		}
		
		function getLINEPay(cat, shop) {
			const s = shop.toUpperCase();
			let base = { bank: '中國信託', name: 'LINE Pay 卡', pointType: 'LINE Points回饋' };
			
			// 2. 排除超商
			if (s.includes('7-11') || s.includes('全家')) {
				return { 
					...base, 
					rate: 0, 
					plan: '無回饋', 
					note: '無回饋', 
					planDesc: '無回饋', 
					dynamicScope: [{ title: '無回饋', shops: '無回饋' }], 
					limit: '無回饋' 
				};
			}
			
			// 1. 海外
			if (s.includes('海外') ) {
				return { 
					...base, 
					rate: 2.8, 
					plan: '海外消費', 
					note: '海外消費', 
					planDesc: '海外消費', 
					dynamicScope: [{ title: '海外消費', shops: '海外消費' }], 
					limit: '無上限' 
				};
			}
			// 3. 一般消費
			return { 
				...base, 
				rate: 1, 
				plan: '一般消費', 
				note: '基本 1%', 
				planDesc: '保底現金回饋。', 
				dynamicScope: [{ title: '一般通路', shops: '非指定加碼之消費' }], 
				limit: '無上限' 
			};
		}

        const sortedResults = computed(() => {
            const sk = shopInput.value.trim().toUpperCase();
            const shopObj = shopDatabase.find(d => d.name.toUpperCase() === sk);
            const cat = shopObj ? shopObj.category : '一般';

            const list = [
                { id: 1, ...getRichart(cat, sk), icon: 'fas fa-gem', iconColor: 'bg-rose-500', rounding: 'floor' },
                { id: 2, ...getCTBC_UNI(cat, sk, uniCount.value), icon: 'fas fa-shopping-cart', iconColor: 'bg-orange-500', rounding: 'round' },
                { id: 3, ...getCube(cat, sk), icon: 'fas fa-id-card', iconColor: 'bg-green-600', rounding: 'round'},
                { id: 4, ...getFed(cat, sk), icon: 'fas fa-comment-dollar', iconColor: 'bg-green-400', rounding: 'round' },
                { id: 5, ...getLINEPay(cat, sk), icon: 'fab fa-line', iconColor: 'bg-emerald-500', rounding: 'round'}
            ];
            return list.sort((a, b) => b.rate - a.rate);
        });

        const openModal = (card) => { activeCard.value = card; };
        const selectShop = (s) => { shopInput.value = s.name; showSuggestions.value = false; };
        const clearSearch = () => { shopInput.value = ''; showSuggestions.value = false; };
        const suggestions = computed(() => {
            if (!shopInput.value || !showSuggestions.value) return [];
            const input = shopInput.value.toUpperCase();
            return shopDatabase.filter(d => d.name.toUpperCase().includes(input)).slice(0, 5);
        });

        return { shopInput, amount, uniCount, sortedResults, suggestions, selectShop, clearSearch, calculateReward, showSuggestions, activeCard, openModal };
    }
}).mount('#app');
</script>
</body>
</html>